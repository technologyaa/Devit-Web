# 서버 수정 체크리스트

## 🔴 현재 문제점
프론트엔드에서 채팅방 생성 시 **500 Internal Server Error** 발생

---

## 1. GET /chat/rooms/private/{memberId} 엔드포인트

### 현재 상황
- 프론트엔드 요청: `GET /chat/rooms/private/9` (예시)
- 서버 응답: **500 Internal Server Error**
- 에러 메시지: `{"code":"INTERNAL_SERVER_ERROR","message":"서버 내부 오류가 발생했습니다."}`

### 확인 사항

#### 1.1 엔드포인트 존재 확인
- [ ] `GET /chat/rooms/private/{memberId}` 경로가 정확히 매핑되어 있는가?
- [ ] 경로 변수 `memberId`가 올바르게 파싱되는가?

#### 1.2 인증/권한 확인
- [ ] JWT 토큰이 올바르게 검증되는가?
- [ ] 현재 로그인한 사용자 정보가 정상적으로 추출되는가?
- [ ] `@PreAuthorize` 또는 인증 필터가 정상 동작하는가?

#### 1.3 비즈니스 로직 확인
- [ ] 1:1 채팅방 조회 로직이 정상 동작하는가?
- [ ] 채팅방이 없을 때 자동 생성 로직이 정상 동작하는가?
- [ ] `memberId`로 사용자를 조회할 수 있는가?
- [ ] 자기 자신과의 채팅방 생성 방지 로직이 있는가?

#### 1.4 데이터베이스 확인
- [ ] 채팅방 조회 쿼리가 정상 동작하는가?
- [ ] 채팅방 생성 시 트랜잭션이 정상 처리되는가?
- [ ] 외래키 제약조건 등으로 인한 오류는 없는가?
- [ ] NULL 체크가 필요한 필드에 NULL이 들어가지 않는가?

#### 1.5 예외 처리 확인
- [ ] 사용자가 존재하지 않을 때 적절한 예외 처리가 되는가? (404 또는 400)
- [ ] 권한이 없을 때 적절한 예외 처리가 되는가? (403)
- [ ] 예상치 못한 예외가 발생할 때 로그가 남는가?

---

## 2. POST /chat/rooms 엔드포인트

### 현재 상황
- 프론트엔드 요청:
  ```json
  {
    "name": "",
    "description": "",
    "type": "PRIVATE",
    "memberIds": [9]
  }
  ```
- 서버 응답: **500 Internal Server Error**

### 확인 사항

#### 2.1 요청 본문 검증
- [ ] `@Valid` 어노테이션이 올바르게 동작하는가?
- [ ] `memberIds` 배열이 비어있지 않은지 확인하는가?
- [ ] `type`이 "PRIVATE"일 때 `memberIds` 길이가 2명(본인 + 상대방)인지 확인하는가?
- [ ] 현재 로그인한 사용자가 `memberIds`에 포함되는가? (자동 추가 로직이 필요한가?)

#### 2.2 비즈니스 로직 확인
- [ ] 1:1 채팅방(`PRIVATE`)일 때 이미 존재하는 채팅방이 있으면 새로 생성하지 않는가?
- [ ] 중복 채팅방 생성 방지 로직이 있는가?
- [ ] `memberIds`에 있는 모든 사용자가 존재하는지 확인하는가?
- [ ] 자기 자신과의 채팅방 생성 방지 로직이 있는가?

#### 2.3 데이터베이스 확인
- [ ] 채팅방 엔티티 생성 시 필수 필드가 모두 채워지는가?
- [ ] `name`이 빈 문자열일 때 기본값이 설정되는가?
- [ ] 채팅방 멤버 관계 테이블에 데이터가 올바르게 저장되는가?
- [ ] 트랜잭션이 정상 커밋되는가?
- [ ] 롤백이 필요한 경우 제대로 롤백되는가?

#### 2.4 응답 형식 확인
- [ ] 응답이 스웨거 명세와 일치하는가?
  ```json
  {
    "status": 0,
    "data": {
      "id": 0,
      "name": "string",
      "description": "string",
      "type": "PRIVATE",
      "memberIds": [0],
      "createdAt": "2025-12-18T01:33:51.176Z"
    }
  }
  ```
- [ ] `id` 필드가 올바르게 반환되는가?

#### 2.5 예외 처리 확인
- [ ] 중복 채팅방 생성 시도 시 적절한 응답을 반환하는가? (409 Conflict 또는 기존 채팅방 반환)
- [ ] 존재하지 않는 사용자 ID가 포함된 경우 적절한 예외를 던지는가? (404 또는 400)
- [ ] 예상치 못한 예외 발생 시 로그에 스택 트레이스가 남는가?

---

## 3. GET /chat/rooms/my-rooms 엔드포인트

### 현재 상황
- 프론트엔드 요청: `GET /chat/rooms/my-rooms`
- 서버 응답: **200 OK** (빈 배열 반환)

### 확인 사항 (선택사항)

#### 3.1 데이터 조회 확인
- [ ] 현재 로그인한 사용자가 속한 채팅방이 올바르게 조회되는가?
- [ ] 조회된 채팅방에 상대방 정보가 포함되는가?
- [ ] 1:1 채팅방일 때 상대방 이름이 `name` 필드에 포함되는가?

#### 3.2 응답 형식 확인
- [ ] 응답이 스웨거 명세와 일치하는가?
  ```json
  {
    "status": 0,
    "data": [
      {
        "id": 0,
        "name": "string",
        "description": "string",
        "type": "PRIVATE",
        "memberIds": [0],
        "createdAt": "2025-12-18T01:33:51.178Z"
      }
    ]
  }
  ```

---

## 4. 공통 확인 사항

### 4.1 로깅
- [ ] 예외 발생 시 스택 트레이스가 로그에 기록되는가?
- [ ] 요청 파라미터와 응답이 로그에 기록되는가? (개발 환경)
- [ ] 500 에러 발생 시 원인을 추적할 수 있는 충분한 정보가 로그에 있는가?

### 4.2 인증/인가
- [ ] JWT 토큰 검증이 모든 채팅 관련 엔드포인트에서 정상 동작하는가?
- [ ] 토큰에서 사용자 ID를 올바르게 추출하는가?

### 4.3 데이터 검증
- [ ] `memberId`가 양수인지 확인하는가?
- [ ] 존재하지 않는 `memberId`로 요청이 올 때 적절히 처리하는가?

### 4.4 에러 응답 형식
- [ ] 에러 응답이 일관된 형식인가?
  ```json
  {
    "status": 500,
    "code": "INTERNAL_SERVER_ERROR",
    "message": "상세한 에러 메시지"
  }
  ```

---

## 5. 권장 수정 사항

### 5.1 GET /chat/rooms/private/{memberId}
```java
// 예시 로직
1. 현재 로그인한 사용자 ID 확인
2. memberId로 대상 사용자 조회 (없으면 404)
3. 자기 자신과의 채팅방 생성 방지
4. 기존 1:1 채팅방 조회
   - 있으면: 기존 채팅방 반환
   - 없으면: 새 채팅방 생성 후 반환
5. 예외 처리 및 로깅
```

### 5.2 POST /chat/rooms
```java
// 예시 로직
1. 요청 본문 검증 (@Valid)
2. 현재 로그인한 사용자 ID 확인
3. PRIVATE 타입일 때:
   - memberIds에 현재 사용자 자동 추가 (없는 경우)
   - 중복 채팅방 확인
   - 있으면: 기존 채팅방 반환 (또는 409 Conflict)
   - 없으면: 새 채팅방 생성
4. 멤버 유효성 검증 (모든 memberId가 존재하는지)
5. 채팅방 생성 및 저장
6. 생성된 채팅방 반환
7. 예외 처리 및 로깅
```

---

## 6. 디버깅 팁

### 6.1 서버 로그 확인
- 서버 콘솔에서 스택 트레이스 확인
- 예외 발생 시점과 원인 파악
- 데이터베이스 쿼리 로그 확인

### 6.2 테스트 방법
1. Postman 또는 Swagger UI에서 직접 테스트
2. 요청 본문을 최소한으로 만들어 테스트 (name, description 제외)
3. 각 단계별로 로그 추가하여 어디서 실패하는지 확인

### 6.3 체크리스트 사용법
- 각 항목을 순서대로 확인
- 문제가 발견된 항목에 체크 표시
- 수정 후 해당 항목을 다시 확인

---

## 7. 프론트엔드 요청 형식 (참고)

### GET /chat/rooms/private/{memberId}
```
요청:
  Method: GET
  Path: /chat/rooms/private/9
  Headers:
    Authorization: Bearer {token}
    Accept: application/json

응답 예상:
  {
    "status": 0,
    "data": {
      "id": 1,
      "name": "string",
      "description": "string",
      "type": "PRIVATE",
      "memberIds": [9, 현재사용자ID],
      "createdAt": "2025-12-18T01:33:51.178Z"
    }
  }
```

### POST /chat/rooms
```
요청:
  Method: POST
  Path: /chat/rooms
  Headers:
    Authorization: Bearer {token}
    Accept: application/json
    Content-Type: application/json
  Body:
    {
      "name": "",
      "description": "",
      "type": "PRIVATE",
      "memberIds": [9]
    }

응답 예상:
  {
    "status": 0,
    "data": {
      "id": 1,
      "name": "",
      "description": "",
      "type": "PRIVATE",
      "memberIds": [9, 현재사용자ID],
      "createdAt": "2025-12-18T01:33:51.176Z"
    }
  }
```

---

## 📝 참고사항

- 프론트엔드는 스웨거 명세에 맞게 요청을 보내고 있습니다.
- 500 에러는 서버 내부 오류이므로 서버 측에서 해결해야 합니다.
- 에러 발생 시 서버 로그의 스택 트레이스를 확인하면 정확한 원인을 파악할 수 있습니다.
- 이 체크리스트를 순서대로 따라가면 문제를 빠르게 해결할 수 있습니다.
